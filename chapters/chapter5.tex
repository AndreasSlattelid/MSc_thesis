\chapter{SOFR- Secured Overnight Financing Rate}

\section{Introduction}
Following the LIBOR scandal, the Federal Reserve and regulators in the U.K. have come up with a replacement called the Secured Overnight Financing Rate (SOFR) \nomenclature{SOFR}{Secured Overnight Financing Rate}.
There are also other RFR alternatives (Risk-Free Reference Rates) \nomenclature{RFR}{Risk-Free Reference Rates} who works in a similar way: like SONIA (Sterling Overnight Index Average) 
\nomenclature{SONIA}{Sterling Overnight Index Average} managed by The Bank of England. One could also mention €STR (Euro Short-Term Rate) \nomenclature{€STR}{Euro Short-Term Rate}
\cite{CME_SOFR}
\\~\\
On November.30,2020, the Federal Reserve announced that the LIBOR will be phased out and eventually replaced by June 2023. Banks were also instructed to stop writing contracts using the LIBOR by end of 2021, and that all contracts using the LIBOR should wrap up by June 30, 2023. \cite{hayes_2022}
\\~\\ 
SOFR is fundamentally different from LIBOR. The Federal Reserve Bank of New York collects transaction data from the overnight Treasury Repo market. It then calculates a volume-weighted median interest rate. Which then gets published 08.00 AM (Eastern Time) the following business day \cite{ARRC_SOFR}.
\\~\\ 
This means that SOFR is backward looking as it is based upon overnight transactions, furthermore, it cannot look beyond 24 hours.  
\\~\\
\textbf{Key differences between LIBOR and SOFR/RFR's}

\begin{enumerate}
    \item Calculation Method: LIBOR is calculated based on submissions from Panel Banks. SOFR is based on the overnight repo market. 
    \item Tenors: LIBOR has multiple tenors, while SOFR has one: overnight. Meaning that LIBOR is forward-looking and SOFR is backwards-looking. 
    \item Validity: Following the LIBOR scandal, one has seen that LIBOR has been more prone to manipulation, as one can give higher or lower rate submissions altering the trimmed mean. SOFR is transaction based, meaning that it is harder to manipulate. 
\end{enumerate}

\newpage 

\begin{definition}[\textbf{Discrete overnight SOFR \cite{Skov_2020}}]
The discrete overnight SOFR is defined as:
\[
R_{d_{i}}(T_{i}) = \frac{1}{d_{i}}\left(
\frac{1}{P(T_{i}, T_{i+1})} - 1
\right)
\]
where:
\begin{itemize}[leftmargin=*]
    \item $d_{i}$: denotes the day count fraction multiplied by the number of days to which the overnight rate applies. I.e. $d_{i} = 1/360$ on business days, and $d_{i} = 3/360$ on fridays. 
\end{itemize}
\end{definition}


\begin{figure}[htp]
    \centering
    \includegraphics[height = 7cm, width=14cm]{figures/SOFR/overnight_SOFR_Volume.JPG}
    \caption{Overnight SOFR rates. Source: \cite{NewYorkFedSOFR}}
    \label{fig: Overnight_SOFR_rates}
\end{figure}

In this Figure, we see the overnight SOFR rates from April 1, 2018 until February 21, 2023. With corresponding traded volumes. 
\\~\\
We see that there was a spike in September 2019, this was due to a large drop in reserves due to tax date \cite{FederalReserve2019}. We also see the effects of the pandemic with almost $0\%$ interest rate, followed by now rising interest rates. 



\newpage 

\section{SOFR futures}
Let $(\Omega, \F, (\F_{t})_{t\geq 0}, Q)$ denote our probability space, and let $Q$ be the risk-neutral probability measure defined via the Radon-Nikodym derivative.
\\~\\
\begin{definition}[\textbf{Futures contract \cite{björk2019arbitrage}}]
A futures contract on $X$ with delivery $T$, is a financial asset with following properties: 
\begin{enumerate}[leftmargin =*]
    \item For all $t$ with $0\leq t \leq T$, there exists in the market a quoted object $f(t,T;X)$ known as the futures price of $X$ at time $t$, with delivery $T$. 
    \item At time $T$ of delivery, the holder of the contract pays: $f(T,T;X)$ and receives the claim $X$.
    \item During an arbitrary interval $(s,t]$, the holder of the contract receives: 
    \[
    f(t,T;X) - f(s,T;X)
    \]
\end{enumerate}
\end{definition}

In typical futures contracts, the underlying asset  
$X$ could be oil barrels, corn, cattle etc. In our situation, the underlying asset is an interest rate. The typical settlement is a cash settlement. 
\\~\\ 
\textbf{Some reasons to enter a futures contract:}
\begin{itemize}
    \item Speculation: By trading futures, one can make money by differences in quotes.  
    \item Hedging: One could hedge against higher/lower interest rates. For instance, someone paying a floating rate might buy futures to lock in a future interest rate. 
\end{itemize}



We will be interested in SOFR futures, such futures can be found at CME (Chicago Mercantile Exchange) \nomenclature{CME}{Chicago Mercantile Exchange}. CME uses the following convention for quoting interest rate futures: 
\[
100 - R
\]
Here $R$ will represent the implied SOFR rate. Let's say that we observe a 3M-SOFR futures today with settlement Jun 23, being quoted at $96.6$. This would mean that the implied $3M$-SOFR rate over the period March 23 - June 23 would be: 
\[
(100-96.6)\% = 3.4\% 
\] 
Further specifications on how CME quotes 3M-SOFR futures can be found in  \cite{cmegroup-sofr-futures}. 






\newpage 

When dealing with SOFR futures one distinguishes between 1-month- and 3-month futures, as they are not calculated in the same way:

\begin{definition}[\textbf{SOFR 1-month arithmetic average \cite{Skov_2020}}]
The 1-month \nomenclature{1M}{1-month}
SOFR arithmetic average of the daily reference rate observed over the period $[S,T]$ is defined as: 
\[
R^{1M}(S,T) = \frac{1}{N}\sum_{i=1}^{N}R_{d_{i}}(T_{i})
\]
where:
\begin{itemize}[leftmargin=*]
    \item $N$: total number of days in the month
    \item $S\leq T_{1} \leq \dots \leq T_{N} \leq T$ 
\end{itemize}
\end{definition}

\begin{definition}[\textbf{SOFR 3-month geometric average}]
The 3-month \nomenclature{3M}{3-months}
SOFR geometric average of the daily reference rate observed over the period $[S,T]$ is defined as: 
\[
R^{3M}(T,S) = \frac{1}{T-S}\left(
\prod_{i=1}^{N}(1+d_{i}R_{d_{i}}(T_{i})) - 1
\right)
\]
\end{definition}


As futures contracts are free to enter, we get that: 
\begin{align*}
\E_{Q}\left[
R^{iM}(S,T) - f^{iM}(t,S,T)\bigg{|}\F_{t}
\right] = 0, \;\; i = 1,3   
\end{align*}

Furthermore one uses the following convention: 
\begin{align*}
R^{1M}(S,T) \approx  \frac{1}{T-S}\int_{S}^{T}r(s)ds 
\;\;\text{and}\;\;
R^{3M}(S,T) \approx  \frac{1}{T-S}\left(e^{\int_{S}^{T}r(s)ds} -1\right) 
\end{align*}

This gives arise to the following definitions:

\begin{definition}[\textbf{1-month SOFR futures \cite{Skov_2020}}]
\label{def: 1M_SOFR_futures}
\nomenclature{$f^{1M}(t,S,T)$}{1-month SOFR futures}
We denote the time $t$ rate of the 1-month futures starting to accrue at time $S$ and with settlement on time $T$ as:
\begin{align*}
f^{1M}(t,S,T) &= \frac{1}{T-S}\E_{Q}\left[
\int_{S}^{T}r(s)ds\bigg{|}\F_{t}
\right]    
\end{align*}
\end{definition} 

\begin{definition}[\textbf{3-month SOFR futures \cite{Skov_2020}}]
\label{def: 3M_SOFR_futures}
\nomenclature{$f^{3M}(t,S,T)$}{3-month SOFR futures}
We denote the time $t$ rate of the 3-month futures starting to accrue at time $S$ and with settlement on time $T$ as:  
\begin{align*}
f^{3M}(t,S,T) &= \frac{1}{T-S}\left(
\E_{Q}\left[e^{\int_{S}^{T}r(s)ds}\bigg{|}\F_{t}\right] - 1
\right)    
\end{align*}
\end{definition} 

\newpage 

\begin{proposition}[\textbf{Vasicek dynamics of 1M/3M-SOFR futures}]
Assume that the short rate has the following dynamics: 
\begin{align*}
dr(t) &= \alpha[m-r(t)]dt + \sigma dW^{Q}(t)    
\end{align*}

Then the dynamics of $f^{1M}(t,S,T)$ is given by:
\begin{align*}
df^{1M}(t,S,T) &= \frac{1}{T-S}B(t,S,T)\sigma dW^{Q}(u)
\end{align*}

and the dynamics of $f^{3M}(t,S,T)$ is given by: 
\begin{align*}
df^{3M}(t,S,T) &= \left(
f^{3M}(t,S,T) +\frac{1}{T-S}
\right)B(t,S,T)\sigma dW^{Q}(t)
\end{align*}

Where: 
\begin{align*}
B(t,S,T) &= \frac{1}{\alpha}\left[
e^{-\alpha(S-t)}-e^{\alpha(T-t)}
\right]    
\end{align*}
\end{proposition}


\begin{proof}

From Proposition \ref{prop: Vasicek_ATS}, we have that: 
\begin{align*}
r(s) &= e^{-\alpha(s-t)}r(t) + m[1-e^{-\alpha(s-t)}] + \sigma \int_{t}^{s}e^{-\alpha(s-u)}dW^{Q}(u)
\end{align*}

Now: $f^{1M}(t,S,T) = \frac{1}{T-S}\E_{Q}\left[\int_{S}^{T}r(s)ds|\F_{t} \right]$:  
\begin{align*}
\E_{Q}\left[
r(s)|\F_{t}
\right]
&= 
r(t)e^{-\alpha(s-t)} + m\left(1-e^{-\alpha(s-t)}\right) \\ 
&\Downarrow \\ 
f^{1M}(t,S,T)
&= 
\frac{e^{-\alpha S}- e^{-\alpha T}}{\alpha(T-S)}[r(t)-m]e^{\alpha t}
+ m 
\end{align*}

Giving arise to the following dynamics: 
\begin{align*}
df^{1M}(t,S,T) 
&= 
\frac{e^{-\alpha S}- e^{-\alpha T}}
{\alpha(T-S)}
d\left[
(r(t)-m)e^{\alpha t}
\right]
\end{align*}

Let's work with the differential part first: 
\begin{align*}
d[(r(t)-m)e^{\alpha t}] &= d[r(t)e^{\alpha t}] - md(e^{\alpha t}) \\
&= \alpha me^{\alpha t}dt + \sigma e^{\alpha t}dW^{Q}(t) - \alpha me^{\alpha t}dt \\ 
&= 
\sigma e^{\alpha t}dW^{Q}(t)
\end{align*}

Thus: 
\begin{align*}
df^{1M}(t,S,T) 
&= 
\frac{e^{-\alpha S}- e^{-\alpha T}}
{\alpha(T-S)}\sigma e^{\alpha t}dW^{Q}(t) \\ 
&= \frac{1}{T-S}B(t,S,T)\sigma dW^{Q}(t)
\end{align*}

\newpage 
Now for $f^{3M}(t,S,T)$ we must study $\int_{S}^{T}r(s)ds$:  
\\~\\
We have the following timeline:

\begin{tikzpicture}[snake=zigzag, line before snake = 5mm, line after snake = 5mm]
    % draw horizontal line   
    \draw (0,0) -- (4,0);
    
    % draw vertical lines
    \foreach \x in {0,1,2,3, 4}
      \draw (\x cm,3pt) -- (\x cm,-3pt);

    % draw nodes
    \draw (0,0) node[below=3pt] {$ t $} node[above=3pt] {$   $};
    \draw (1,0) node[below=3pt] {$ S $} node[above=3pt] {$  $};
    \draw (2,0) node[below=3pt] {$ u $} node[above=3pt] {$  $};
    \draw (3,0) node[below=3pt] {$ s $} node[above=3pt] {$  $};
    \draw (4,0) node[below=3pt] {$ T $} node[above=3pt] {$  $};
  \end{tikzpicture}

namely $t\leq S \leq u \leq s \leq T$, this gives us: 
\begin{align*}
\int_{S}^{T}r(s)ds &= \frac{r(t)}{\alpha}\left[
e^{-\alpha(S-t)} - e^{-\alpha(T-t)}
\right]   
+ m(T-S) - \frac{m}{\alpha}\left[
e^{-\alpha(S-t)} - e^{-\alpha(T-t)}
\right] \\ 
&+ 
\sigma 
\underbrace{
\int_{S}^{T}\int_{t}^{s}e^{-\alpha(s-u)}dW^{Q}(u)ds
}_{=(*)}
\end{align*}

Now by additivity of the integral, we see that: 
\begin{align*}
\int_{t}^{s} = \int_{t}^{S} + \int_{S}^{s}    
\end{align*}

This leaves us with: 
\begin{align*}
(*) &= 
\int_{S}^{T}\left(
\int_{t}^{S}e^{-\alpha(s-u)}dW^{Q}(u) + \int_{s}^{S}e^{-\alpha(s-u)}dW^{Q}(u)
\right)ds \\ 
&= 
\underbrace{
\int_{S}^{T}\int_{t}^{S}e^{-\alpha(s-u)}dW^{Q}(u)ds 
}_{=(1)}
+ 
\underbrace{
\int_{S}^{T}\int_{S}^{s}e^{-\alpha(s-u)}dW^{Q}(u)ds
}_{= (2)}
\end{align*}

By Stochastic Fubini, we get: 
\begin{align*}
(1) &= \int_{S}^{T}\int_{t}^{S}e^{-\alpha(s-u)}dW^{Q}(u)ds 
= \int_{t}^{S}\int_{S}^{T}e^{-\alpha(s-u)}dsdW^{Q}(u) 
= (1)'
\end{align*}


\begin{tikzpicture}[snake=zigzag, line before snake = 5mm, line after snake = 5mm]
    % draw horizontal line   
    \draw (0,0) -- (4,0);
    
    % draw vertical lines
    \foreach \x in {0,2,4}
      \draw (\x cm,3pt) -- (\x cm,-3pt);

    % draw nodes
    \draw (0,0) node[below=3pt] {$ S $} node[above=3pt] {$   $};
    \draw (1,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
    \draw (2,0) node[below=3pt] {$ u $} node[above=3pt] {$  $};
    \draw (3,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
    \draw (4,0) node[below=3pt] {$ s $} node[above=3pt] {$  $};
  \end{tikzpicture}


\begin{align*}
\begin{cases}
 S \leq s \leq T \\ 
 S \leq u \leq s
\end{cases}
&\iff
\begin{cases}
 u \leq s \leq T \\ 
 S \leq u \leq T
\end{cases}
\end{align*}

Now this leaves us with: 
\begin{align*}
(2) &= \int_{T}^{S}\int_{u}^{T}e^{-\alpha(s-u)}dsdW^{Q}(u) = (2)'
\end{align*}

We now calculate the inner integral in $(1)'$ and $(2)'$ respectively: 
\begin{align*}
\int_{S}^{T}e^{-\alpha(s-u)}ds &= \frac{1}{\alpha}\left[
e^{\alpha(S-u)}-e^{-\alpha(T-u)}
\right] \\ 
\int_{u}^{T}e^{-\alpha(s-u)}ds &= \frac{1}{\alpha}\left[
1 -e^{-\alpha(T-u)}
\right]
\end{align*}

We can then define: 
\begin{align*}
\Sigma(u,t,S,T) &= 
    \begin{cases}
      \frac{1}{\alpha}\left[
      e^{\alpha(S-u)}-e^{-\alpha(T-u)}\right],  & u \in [t,S)\\
      \frac{1}{\alpha}\left[1 -e^{-\alpha(T-u)}\right], & u\in [S,T]
    \end{cases}
\end{align*}

We are thus left with: 
\begin{align*}
\int_{S}^{T}r(s)ds &= \frac{r(t)}{\alpha}\left[
e^{-\alpha(S-t)} - e^{-\alpha(T-t)}
\right]   
+ m(T-S) - \frac{m}{\alpha}\left[
e^{-\alpha(S-t)} - e^{-\alpha(T-t)}
\right] \\
&+ \frac{\sigma}{\alpha}\int_{t}^{T}\Sigma(u,t,S,T)dW^{Q}(s) \\ 
&= 
\left(
\frac{r(t)-m}{\alpha}
\right)
\left[
e^{-\alpha(S-t) - e^{-\alpha(T-t)}}
\right]
+ m(T-S) 
+ 
\underbrace{
\frac{\sigma}{\alpha}\int_{t}^{T}\Sigma(u,t,S,T)dW^{Q}(s)
}_{\F_{t}-\text{independent}}
\end{align*}


As the last part is $\F_{t}$-independent,we get: 
\begin{align*}
\E_{Q}\left[
\exp\left(
\int_{S}^{T}r(s)ds
\right)\bigg{|}\F_{t}
\right] 
&= 
\exp\left(
\left(
\frac{r(t)-m}{\alpha}
\right)
\left[
e^{-\alpha(S-t) - e^{-\alpha(T-t)}}
\right]
+ m(T-S) 
\right)\times \\ 
&\E_{Q}\left[
\exp\left(
\frac{\sigma}{\alpha}\int_{S}^{T}\Sigma(u,t,S,T)dW^{Q}(u)
\right)
\right]
\end{align*}

Since $\Sigma$ is deterministic, we have that: 
\begin{align*}
\E_{Q}\left[
\exp\left(
\frac{\sigma}{\alpha}\int_{S}^{T}\Sigma(u,t,S,T)dW^{Q}(u)
\right)
\right]
&= 
\exp\left(
\frac{1}{2}\frac{\sigma^{2}}{\alpha^{2}}\int_{t}^{T}\Sigma^{2}(u,t,S,T)du
\right)
\end{align*}

This leaves us with the following expression:
\begin{align*}
 \E_{Q}\left[
\exp\left(
\int_{S}^{T}r(s)ds
\right)\bigg{|}\F_{t}
\right] 
&= 
\exp\left(
A(t,S,T) + B(t,S,T)r(t)
\right):= g(t,r(t))
\end{align*}

where: 
\begin{align*}
A(t,S,T) &= m(T-S) - \frac{m}{\alpha}\left[
e^{-\alpha(S-t)} - e^{-\alpha(T-t)}
\right] + \frac{1}{2}\frac{\sigma^{2}}{\alpha^{2}}\int_{t}^{T}\Sigma^{2}(u,t,S,T) \\
B(t,S,T) &= \frac{1}{\alpha}\left[
e^{-\alpha(S-t)} - e^{-\alpha(T-t)}
\right]
\end{align*}

This means that we have: 
\begin{align*}
f^{3M}(t,S,T) &= \frac{1}{T-S}\left[
g(t,r(t) - 1
\right]    
\end{align*}

We note that $\E_{Q}\left[
\exp\left(
\int_{S}^{T}r(s)ds
\right)\bigg{|}\F_{t}
\right]$ is a $Q$-martingale, thus from the Martingale Representation Theorem \ref{thm: Martingale_rep_thm}, we can neglect the dt-terms of $g(t,r(t))$:
\\~\\
We apply Ito's Formula as $g(t,x) \in C^{1,2}([0,\infty]\times \R)$, giving us: 
\begin{align*}
\partial_{t}g(t,x) &= 0, \;\; \partial_{x}g(t,x) = g(t,x)B(t,S,T), \;\; 
\partial_{xx}g(t,x) = g(t,x)B^{2}(t,S,T) \\ 
dr(t)^{2} &= \sigma^{2}dt \\ 
&\Downarrow \\ 
dg(t,r(t)) &= B(t,S,T)g(t,r(t))\sigma dW^{Q}(t)
\end{align*}

\newpage 

This gives the following dynamics for $f^{3M}(t,S,T)$:
\begin{align*}
df^{3M}(t,S,T) &= \frac{1}{T-S}dg(t,r(t)) \\ 
&= \frac{1}{T-S}B(t,S,T)\exp\left(A(t,S,T) + B(t,S,T)r(t)\right)\sigma dW^{Q}(t)\\ 
&= 
\frac{1}{T-S}B(t,S,T)\left[
(T-S)f^{3M}(t,S,T) +1
\right]\sigma dW^{Q}(t) \\ 
&= 
\left(
f^{3M}(t,S,T) + \frac{1}{T-S}
\right)B(t,S,T)\sigma dW^{Q}(t)
\end{align*}



\end{proof}



\newpage 

\section{Options on SOFR futures}

Consider a call option on a SOFR futures, with exercise time $\tau \leq S \leq T$ and strike $\kappa$, the price at time $t \leq \tau$ for $i=1,3$ is given by:
\begin{align*}
C^{iM}(t,\tau) :&= \E_{Q}\left[
\frac{B(t)}{B(\tau)}\left(
f^{iM}(t,S,T) - \kappa
\right)^{+}
\bigg{|}\F_{t}
\right]  
&\stackrel{\text{Prop \ref{prop: general_option_price}}}{=} 
P(t,\tau)\E_{Q^{\tau}}\left[
\left(f^{iM}(t,S,T) - \kappa
\right)^{+}
\bigg{|}\F_{t}
\right]
\end{align*} 

Here we use the convention that $(x)^{+} = \max(x,0)$. From Theorem \ref{thm: arbitrage_condition_Q}, we have: 
\begin{align*}
\frac{dQ^{\tau}}{dQ}\bigg{|}_{\F_{t}} &= \mathcal{E}_{t}(v(\cdot, \tau)\bullet W^{Q})
\end{align*} 

Assuming Novikov's condition holds, i.e: $\E_{Q}\left[e^{\frac{1}{2}\int_{0}^{T}\norm{v(s,\tau)}^{2}ds}\right] < \infty$ we get from Girsanov's theorem, that
\begin{align*}
dW^{\tau}(t) &= dW^{Q}(t) - v(t,\tau)dt    
\end{align*}
defines a $Q^{\tau}$-Brownian motion. 
\\~\\ 
\begin{proposition}[\textbf{1M-SOFR futures Caplet}]
Consider a call option on the 1M-SOFR futures with exercise time $\tau \leq T$ and strike $\kappa$. Let 
\[
df^{1M}(t,S,T) = \Sigma^{1M}(t,S,T)dW^{Q}(t)  
\]
Where $\Sigma^{1M}(t,S,T)$ is assumed to be a deterministic and bounded function. The price at time $t\leq \tau$ is given by: 
\begin{align*}
C^{1M}(t,\tau) &= 
P(t,\tau)\sqrt{
\int_{t}^{\tau}\Sigma^{1M}(u,S,T)^{2}du
}\left[
d\Phi(d) + \varphi(d)
\right]
\end{align*}
Where: 
\begin{align*}
d &= 
\frac{
f^{1M}(t,S,T) + \int_{t}^{\tau}\Sigma^{1M}(u,S,T)v(u,\tau)du - \kappa
}{
\sqrt{
\int_{t}^{\tau}\Sigma^{1M}(u,S,T)^{2}du
}
}
\end{align*}
And $\Phi, \varphi$ represents the cumulative and density function of a standard-normal distribution respectively. 
\end{proposition}

\begin{proof}
The $Q^{\tau}$-dynamics are given by: 
\begin{align*}
df^{1M}(t,S,T) &= 
\Sigma^{1M}(t,S,T)v(t,\tau)dt + \Sigma^{1M}(t,S,T)dW^{\tau}(t)\\ 
&\Downarrow \\ 
f^{1M}(\tau,S,T) &= 
\underbrace{f^{1M}(t,S,T)}_{x} + 
\underbrace{\int_{t}^{\tau}\Sigma^{1M}(u,S,T)v(u,\tau)du}_{m} +  
\int_{t}^{\tau}\Sigma^{1M}(u,S,T)dW^{\tau}(u)
\end{align*}    

Let 
\[
b^{2} = \int_{t}^{\tau}\Sigma^{1M}(u,S,T)^{2}du
\]

We are then left with: 
\begin{align*}
C^{1M}(t,\tau) &= 
\E_{Q^{\tau}}\left[
(f^{1M}(\tau, S,T)-\kappa)^{+}|\F_{t}
\right]    
= 
\E\left[
(x+m+bZ-\kappa)^{+}
\right]\bigg{|}_{x = f^{1M}(t,S,T)}
\end{align*}

where $Z \sim \mathcal{N}(0,1)$, this yields: 

\begin{align*}
\E\left[
(x+m+bZ-\kappa)^{+}
\right]\bigg{|}_{x = f^{1M}(t,S,T)} 
&= 
\int_{\R}(x+m+bz-\kappa)^{+}\varphi(z)dz 
\end{align*}

furthermore: 
\begin{align*}
x + m + bz - \kappa \geq 0 \iff z \geq \frac{\kappa-x-m}{b}:= d'    
\end{align*}

This yields: 
\begin{align*}
\int_{\R}(x+m+bz-\kappa)^{+}\varphi(z)dz  
&= 
\underbrace{
(x+m-\kappa)\int_{d'}^{\infty}\varphi(z)dz
+ b\int_{d'}^{\infty}z\varphi(z)dz
}_{(A)}
\end{align*}

By symmetry of the normal distribution we have: $P(Z > d') = P(Z \leq -d')$, 
where we define: 
\[
d := -d' = \frac{x+m-\kappa}{b}
\]
furthermore $z\varphi(z) = - \varphi'(z)$, thus:

\begin{align*}
\int_{d'}^{\infty}z\varphi(z)dz
&= 
-\int_{d'}^{\infty}\varphi'(z)dz 
= 
-(\varphi(\infty) - \varphi(d'))
= \varphi(d') = \varphi(d)
\end{align*}

Leaving us with:
\begin{align*}
(A) &= (x+m-\kappa)\Phi(d) + b\varphi(d) \\ 
&= b[d\Phi(d) + \varphi(d)]
\end{align*}
Now from Proposition \ref{prop: general_option_price}, we get: 
\begin{align*}
C^{1M}(t,\tau) :&= \pi(t) = P(t,\tau)\E_{Q^{\tau}}\left[
(f^{1M}(\tau, S,T)-\kappa)^{+}|\F_{t}
\right] \\ 
&= 
P(t,\tau)\sqrt{
\int_{t}^{\tau}\Sigma^{1M}(u,S,T)^{2}du
}\left[
d\Phi(d) + \varphi(d)
\right]
\end{align*}
\end{proof}


\newpage 

\section{SOFR hedges}
For SOFR futures we have that there are two approaches for pricing namely arithmetic (1 month) and geometric (3 months), in this section we will study different hedges depending upon what one wants to hedge. 


\subsection{Hedging 3-month arithmetic with 3-month geometric}
Consider the case where we want to hedge: 
$$
X^{3M_{A}}(S,T) = \frac{1}{T-S}\int_{S}^{T}r_{u}du
$$

Here $[S,T]$ will denote a 3-month period, in the market we only have available
3-month futures $f^{3M}(t,S,T)$ (\ref{def: 3M_SOFR_futures})  calculated using a geometric average, this means that our hedge will look like: 
\begin{align*}
\argmin\limits_{a_{t} \in \R}\E_{Q}\left[
\left(
X^{3M_{A}}(S,T)-a_{t}f^{3M}(t,S,T)
\right)^{2}
\bigg{|}\F_{t}
\right]
\end{align*}

Now, fix $t$ and denote
 $G(a_{t}) :=\E_{Q}\left[
\left(X^{3M_{A}}(S,T)-a_{t}f^{3M}(t,S,T)
\right)^{2}
\bigg{|}\F_{t}
\right]
$ 
expanding the square yields:
\begin{align*}
G(a_{t}) &= \E_{Q}\left[(X^{3M_{A}}(S,T))^{2}|\F_{t}\right] -2a_{t}f^{3M}(t,S,T) +
a_{t}^{2}[f^{3M}(t,S,T)]^{2}
\end{align*}
Taking the derivative w.r.t. $a_{t}$ yields: 
\begin{align*}
\frac{d}{da_{t}}G(a_{t}) &= -2f^{3M}(t,S,T) + 2a_{t}[f^{3M}(t,S,T)]^{2}  
\end{align*} 

Now as $\frac{d^{2}}{da_{t}^{2}}G(a_{t}) = 2[f^{3M}(t,S,T)]^{2} > 0$, we have that the minimum is obtained by setting $\frac{d}{da_{t}}G(a_{t}) = 0$:
\begin{align*}
\frac{d}{da_{t}}G(a_{t}) &= 0 \\ 
&\Downarrow \\ 
a_{t} &= \frac{
\E_{Q}[X^{3M_{A}}(S,T)|\F_{t}]
}{
f^{3M}(t,S,T)
} \\ 
&= \frac{
\int_{S}^{T}\E_{Q}[r(u)|\F_{t}]du
}{
(T-S)f^{3M}(t,S,T)
}
\end{align*}

\begin{result}
\label{result: optimal_SOFR_hedge_3MA_vs_3GM}
Considering the above situation, we then have the following:
\begin{align*}
\argmin\limits_{a_{t} \in \R_{0}}\E_{Q}\left[
\left(
X^{3M_{A}}(S,T)-a_{t}f^{3M}(t,S,T)
\right)^{2}
\bigg{|}\F_{t}
\right] 
\implies
\hat{a}_{t} = \frac{
\int_{S}^{T}\E_{Q}[r(u)|\F_{t}]du
}{
(T-S)f^{3M}(t,S,T)
}
\end{align*}
\end{result} 

\newpage 

\subsection{Affine Term Structure-setting}

\begin{proposition}
Consider the above setting, and let $r = (r_{t})_{t\geq 0}$ be a model that provides ATS, then 
\begin{align*}
\argmin\limits_{a_{t} \in \R}&\E_{Q}\left[
\left(
X^{3M_{A}}(S,T)- a_{t}f^{3M}(t,S,T)
\right)^{2}
\bigg{|}\F_{t}
\right] \\
&\Downarrow \\
\hat{a}_{t} &= \frac{
r(t)(T-S)
+ \int_{S}^{T}\int_{t}^{u}b(s)dsdu 
+ \int_{S}^{T}\int_{t}^{u}\alpha(s)g(s)dsdu
}{
(T-S)f^{3M}(t,S,T)
}
\end{align*}
Where:
\begin{align*}
g(s) &= \exp\left(
\int_{t}^{s}\beta(v)dv
\right)
\left(
\int_{t}^{s}e^{-\int_{t}^{w}\beta(v)dv}b(w)dw + \E_{Q}[r(t)]
\right) 
\end{align*}
\end{proposition}

\begin{proof}
Consider the above setting, but now we assume that $r = (r_{t})_{t\geq 0}$ is a model that provides ATS (Affine Term Structure), now as described in proposition \ref{prop: condition_on_r_ATS}, we have that the dynamics of $r$ can be written as: 
\begin{align*}
dr(t) &= [b(t) + \beta(t)r(t)]dt + \sqrt{a(t) + \alpha(t)r(t)}dW^{Q}(t)
\end{align*}
Here $b, \beta, a, \alpha$ are deterministic continuous functions. Now from the dynamics, we get that for $u\geq t$: 
\begin{align*}
r(u) &= r(t) + \int_{t}^{u}b(s)ds + \int_{t}^{u}[\beta(s)r(s)]ds
+ \int_{t}^{u}\sqrt{\alpha(s)}dW^{Q}(s)
+ \int_{t}^{u}\sqrt{\alpha(s)r(s)}dW^{Q}(s)
\end{align*}

Each term is assumed to be Ito-integrable, i.e in $M^{2}([0,T])$, and by \\ $\F_{t}$-independence, we get:
\begin{align*}
\E_{Q}\left[
\int_{t}^{u}\sqrt{\alpha(s)}dW^{Q}(s)
\right]
&= 0 \\ 
\E_{Q}\left[
\int_{t}^{u}\sqrt{\alpha(s)r(s)}dW^{Q}(s)
\right] 
&= 0
\end{align*} 

And by using Stochastic-Fubini(\ref{thm: Stochastic_Fubini}), we get:
\begin{align*}
\E_{Q}\left[
\int_{t}^{u}[\beta(s)r(s)]ds
\right]
&= 
\int_{t}^{u}\beta(s)\E_{Q}[r(s)]ds
\end{align*}

This leaves us with: 
\begin{align*}
\int_{S}^{T}\E_{Q}[r(u)|\F_{t}]du 
&= r(t)(T-S)
+ \int_{S}^{T}\int_{t}^{u}b(s)dsdu 
+ \int_{S}^{T}\int_{t}^{u}\alpha(s)\E_{Q}[r(s)]dsdu
\end{align*}


\textbf{Overview of time-interval:}


\begin{tikzpicture}[snake=zigzag, line before snake = 5mm, line after snake = 5mm]
    % draw horizontal line   
    \draw (0,0) -- (9,0);
    %\draw[snake] (2,0) -- (4,0);
    %\draw (4,0) -- (5,0);
    %\draw[snake] (5,0) -- (7,0);
    %\draw[snake] (7,0) -- (9,0);
    %\draw (9,0) -- (10,0);

    % draw vertical lines
    \foreach \x in {0,2,4,5,7}
      \draw (\x cm,3pt) -- (\x cm,-3pt);

    % draw nodes
    \draw (0,0) node[below=3pt] {$ t $} node[above=3pt] {$   $};
    %\draw (1,0) node[below=3pt] {$ T_{0} $} node[above=3pt] {$  $};
    \draw (2,0) node[below=3pt] {$ S $} node[above=3pt] {$  $};
    %\draw (3,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
    \draw (4,0) node[below=3pt] {$ s $} node[above=3pt] {$  $};
    \draw (5,0) node[below=3pt] {$ u $} node[above=3pt] {$  $};
    \draw (6,0) node[below=3pt] {$  $} node[above=3pt] {$  $};
    \draw (7,0) node[below=3pt] {$ T $} node[above=3pt] {$ $};
    %\draw (9,0) node[below=3pt] {$ T_{M} $} node[above=3pt] {$ $};
\end{tikzpicture} 
  
Thus in our setting we have: $t\leq S \leq s \leq u \leq T$, using same argument as above: 

\begin{align*}
r(s) &= r(t) + \int_{t}^{s}b(v)dv + \int_{t}^{s}[\beta(v)r(v)]dv
+ \int_{t}^{s}\sqrt{\alpha(v)}dW^{Q}(v)
+ \int_{t}^{s}\sqrt{\alpha(v)r(v)}dW^{Q}(v)    
\end{align*}

Now let $g(s) := \E_{Q}[r(s)]$: 
\begin{align*}
g(s) &= r(t) + \int_{t}^{s}b(v)dv + \int_{t}^{s}\beta(v)\E_{Q}[r(v)]dv
\end{align*}

Now taking the derivative w.r.t. $s$ and using the fundamental theorem of calculus, we get: 
\begin{align*}
g'(s) &= b(s) + \beta(s)\E_{Q}[r(s)] \\ 
&= b(s) + \beta(s)g(s), \; g(t) = \E_{Q}[r(t)]
\end{align*}

This is an ordinary differential equation, with the explicit solution given by:
\begin{align*}
 g(s) &= \exp\left(
 \int_{t}^{s}\beta(v)dv
 \right)
 \left(
 \int_{t}^{s}e^{-\int_{t}^{w}\beta(v)dv}b(w)dw + \E_{Q}[r(t)]
 \right)
\end{align*}
\end{proof}


\subsection{Hedging with available instruments in the market}

We now denote: 
\begin{align*}
X^{3M_{A}}(S,T) &= \frac{1}{T-S}\int_{S}^{T}r_{u}du = \frac{1}{T-S}Z(S,T) \\ 
f^{3M_{A}}(t,S,T) &= \frac{1}{T-S}\E_{Q}\left[
\int_{S}^{T}r_{u}du
\right] = \frac{1}{T-S}\E_{Q}[Z(S,T)|\F_{t}]
\end{align*}

Now from Jensen's Inequality \ref{thm: Jensen's_ineuality}, we have that for $Z, \varphi(Z) \in L^{1}(\Omega, \F, Q)$, with $\varphi(x) = e^{x}$
\begin{align}
\label{eq: hedging_availible_inst_market_1}
\exp\left(
\E_{Q}[Z(S,T)|\F_{t}]
\right)
&\leq 
\E_{Q}\left[
\exp(Z(S,T))|\F_{t}
\right] \nonumber \\ 
&\Updownarrow \nonumber \\ 
\exp\left(
(T-S)f^{3M_{A}}(t,S,T)
\right) 
&\leq 
\E_{Q}\left[\exp(Z(S,T))|\F_{t}\right]
\end{align} 

Now from definition \ref{def: 3M_SOFR_futures}, we have: 
\begin{align}
\label{eq: hedging_availible_inst_market_2}
f^{3M}(t,S,T) &= \frac{1}{T-S}\left(
\E_{Q}\left[
\underbrace{e^{\int_{S}^{T}r_{u}du}}_{e^{Z}}
\bigg{|}\F_{t}\right] - 1
\right) \nonumber \\ 
&\Downarrow \nonumber \\ 
\E_{Q}[\exp(Z(S,T))|\F_{t}] &= (T-S)f^{3M}(t,S,T) + 1
\end{align}

Now by inserting \ref{eq: hedging_availible_inst_market_2} into \ref{eq: hedging_availible_inst_market_1} yields:

\begin{align*}
\exp\left(
(T-S)f^{3M_{A}}(t,S,T)
\right) 
&\leq 
(T-S)f^{3M}(t,S,T) + 1 \\ 
&\Updownarrow \\
f^{3M_{A}}(t,S,T) &\leq 
\frac{
\ln[(T-S)f^{3M}(t,S,T)]
}{
(T-S)
}
\end{align*}

\newpage 

\subsection{Hedging three-month arithmetic with 1M-SOFR futures}
\label{sec: 3M_A_vs_(a,b,c)_1M_SOFR}
We still want to hedge: 
$$
X^{3M_{A}}(S,T) = \frac{1}{T-S}\int_{S}^{T}r_{u}du
$$

However, now we will not use the available 3M-SOFR future contract, rather we will hedge by buying three 1M-SOFR future contracts at time $t$. Here $[S,T]$ will still denote a 3M period, since we need to buy three futures to cover this interval, we get the following timeline: 


\begin{tikzpicture}[snake=zigzag, line before snake = 5mm, line after snake = 5mm]
    % draw horizontal line   
    \draw (0,0) -- (8,0);
    %\draw[snake] (2,0) -- (4,0);
    %\draw (4,0) -- (6,0);
    %\draw[snake] (6,0) -- (8,0);
    %\draw (8,0) -- (9,0);
    % Calligraphic brace
    \draw [
    decorate, 
    decoration = {calligraphic brace,
                  raise=5pt,
                  amplitude=5pt,
                  aspect=0.50}] (1,0) --  (7.0,0)
                  node[pos=0.50, above =1 0pt,black]{$3M$};

    % draw vertical lines
    \foreach \x in {0,1.0,3.0,5.0,7.0}
      \draw (\x cm,3pt) -- (\x cm,-3pt);

    % draw nodes
    \draw (0,0) node[below=3pt] {$ t $} node[above=3pt] {$   $};
    \draw (1,0) node[below=3pt] {$ S $} node[above=3pt] {$  $};
    \draw (3.0,0) node[below=3pt] {$ T_{1M} $} node[above=3pt] {$  $};
    \draw (5.0,0) node[below=3pt] {$ T_{2M} $} node[above=3pt] {$  $};
    \draw (7.0,0) node[below=3pt] {$ T $} node[above=3pt] {$   $};
  \end{tikzpicture}


\begin{align*}
\argmin\limits_{(a_{t}, b_{t}, c_{t})\in \R^{3}}\E_{Q}\left[
\left(
X^{3M_{A}}(S,T)- \left[
a_{t}f^{1M}(t,S,T_{1M}) + 
b_{t}f^{1M}(t,T_{1M}, T_{2M}) + 
c_{t}f^{1M}(t,T_{2M}, T)
\right]
\right)^{2}
\bigg{|}\F_{t}
\right]
\end{align*}

Denote: 
\begin{align*}
G(a_{t}, b_{t}, c_{t}) := 
\E_{Q}\left[
\left(
X^{3M_{A}}(S,T)- \left[
a_{t}f^{1M}(t,S,T_{1M}) + 
b_{t}f^{1M}(t,T_{1M}, T_{2M}) + 
c_{t}f^{1M}(t,T_{2M}, T)
\right]
\right)^{2}
\bigg{|}\F_{t}
\right]
\end{align*} 

Expanding the square yields: 
\begin{align*}
G(a_{t}, b_{t}, c_{t}) 
&= 
\E_{Q}\left[(X^{3M_{A}}(S,T))^{2}|\F_{t} \right] \\
&-2\E_{Q}[X^{3M_{A}}(S,T)|\F_{t}]\left[
a_{t}f^{1M}(t,S,T_{1M}) + 
b_{t}f^{1M}(t,T_{1M}, T_{2M}) + 
c_{t}f^{1M}(t,T_{2M}, T)
\right] \\ 
&+ a_{t}^{2}[f^{1M}(t,S,T_{1M})]^{2} \\ 
&+ 2a_{t}f^{1M}(t,S,T_{1M})\left[
b_{t}f^{1M}(t,T_{1M}, T_{2M}) + 
c_{t}f^{1M}(t,T_{2M}, T)
\right] \\ 
&+ b_{t}^{2}[f^{1M}(t,T_{1M}, T_{2M})]^{2} \\ 
&+ 2b_{t}c_{t}\left[
f^{1M}(t,T_{1M}, T_{2M})f^{1M}(t,T_{2M}, T)
\right] \\ 
&+ c_{t}^{2}[f^{1M}(t,T_{2M}, T)]^{2}
\end{align*} 

Fix $t$, and denote $(a_{t}, b_{t}, c_{t}) = (x_{1}, x_{2}, x_{3}) = \mathbf{x}$ furthermore let: 
\[
\left(
f^{1M}(t,S,T_{1M}),f^{1M}(t,T_{1M}, T_{2M}), f^{1M}(t,T_{2M}, T) 
\right)
= \left(
\alpha, \beta, \gamma
\right)
\]
We also let: 
\begin{align*}
\E_{Q}\left[(X^{3M_{A}}(S,T))^{2}|\F_{t} \right] &= p \\ 
\E_{Q}[X^{3M_{A}}(S,T)|\F_{t}] &= q
\end{align*}

This leaves us with: 
\begin{align*}
G(\mathbf{x}) &= 
p \\
&- 2q\left[
\alpha x_{1} + \beta x_{2} + \gamma x_{3}
\right] \\ 
&+ \alpha^{2}x_{1}^{2} \\ 
&+ 2\alpha x_{1}\left[
\beta x_{2} + \gamma x_{3}
\right] \\ 
&+ \beta^{2}x_{2}^{2} \\ 
&+ 2\beta\gamma x_{2}x_{3} \\ 
&+ \gamma^{2}x_{3}^{2}
\end{align*}


\newpage 
To get a bit better grasp of $G(\mathbf{x})$ we include a level plot:

\begin{figure}[htp]
    \centering
    \includegraphics[width=12cm]{figures/SOFR/plot_G(x)_special_case.PNG}
    \caption{level Curve $G(\mathbf{x}) = k$, where all constants are set to one}
    \label{fig: plot_G(x)_SOFR_1M}
\end{figure}

\textbf{NB!} Figure \ref{fig: plot_G(x)_SOFR_1M}, is purely for illustration purposes, this will not be a realistic representation of $G(\mathbf{x})$. 
\\~\\
We will be interested in obtaining a minimum of $G(\mathbf{x})$, meaning that we will be interested in the following:  

\begin{align*}
\nabla G(\mathbf{x}) &= 
\left(
\partial_{x_{1}}G(\mathbf{x}), 
\partial_{x_{2}}G(\mathbf{x}), 
\partial_{x_{3}}G(\mathbf{x})
\right) 
\end{align*}

Where: 
\begin{align*}
\partial_{x_{1}}G(\mathbf{x}) &= 
-2q\alpha 
+ 2 \alpha^{2}x_{1}  
+ 2\alpha\left[
\beta x_{2}+ \gamma x_{3}
\right] \\ 
\\
\partial_{x_{2}}G(\mathbf{x}) &=
-2q\beta
+ 2\beta^{2} x_{2}
+ 2\beta\left[
\alpha x_{1} + \gamma x_{3}
\right] \\ 
\\ 
\partial_{x_{3}}G(\mathbf{x}) &=
-2q\gamma
+ 2\gamma^{2}x_{3}
+ 2\gamma\left[
\alpha x_{1} + \beta x_{2}
\right]
\end{align*}

In order to verify that $G$ obtains a minimum we need the Hessian matrix $H(G)$ of $G$. This will be a $3\times 3$ matrix with entries:  

\begin{align*}
[H(G)]_{i,j} &= 
\frac{
\partial^{2}G
}{
\partial x_{i}\partial x_{j}
}, \; i=1,2,3,\;j=1,2,3
\end{align*}

Meaning that our Hessian matrix looks the following:
\begin{align*}
H(G) &= 
\begingroup
\renewcommand*{\arraystretch}{1.5}
\begin{bmatrix}
2\alpha^{2} & 
2\alpha \beta & 
2\alpha \gamma \\ 
2\alpha \beta &
2\beta^{2} &
2\beta \gamma \\
2\alpha \gamma &
2\beta \gamma & 
2\gamma^{2}
\end{bmatrix}
\endgroup
\end{align*}


Now as $\frac{\partial^{2}G(\mathbf{x}) }{\partial x_{i}^{2}} > 0$ for $i=1,2,3$ we know that the minimum should be obtained by setting $\partial_{x_{i}}G(\mathbf{x}) = 0$, i.e we must solve: 
\begin{align}
\label{eq: partial_derivative_equal_zero}
\nabla G(\mathbf{x}) = \mathbf{0}    
\end{align}

Now Equation \ref{eq: partial_derivative_equal_zero}, gives arise to the following matrix equation: 
\begin{align*}
\underbrace{
\begin{bmatrix}
\alpha^{2} & \alpha\beta & \alpha\gamma \\ 
\beta^{2} & \alpha\beta & \beta\gamma \\ 
\gamma^{2} & \alpha\gamma & \beta\gamma
\end{bmatrix}
}_{A}
\underbrace{
\begin{bmatrix}
x_{1} \\ 
x_{2} \\ 
x_{3}
\end{bmatrix}
}_{\mathbf{x}}
&= 
\underbrace{
q 
\begin{bmatrix}
\alpha \\ 
\beta \\ 
\gamma 
\end{bmatrix}
}_{\mathbf{b}}
\iff  
A\mathbf{x} = \mathbf{b}
\end{align*}

Now: 
\begin{align*}
\det(A) &= 
\alpha^{2}\left[
\alpha\beta^{2}\gamma - \alpha\beta\gamma^{2}
\right]
- \alpha\beta\left[
\beta^{3}\gamma - \beta\gamma^{3}
\right]
+ \alpha\gamma\left[
\beta^{2}\alpha\gamma -\alpha\beta\gamma^{2}
\right] \\ 
&= 
\alpha\beta\gamma(\beta-\gamma)\left[
\alpha(\alpha+\gamma) -\beta(\beta + \gamma)
\right]
\end{align*}

In order for $\det(A) \neq 0$, we must have:
\begin{empheq}[box=\fbox]{align}
\alpha &\neq 0, \; \beta \neq 0, \; \gamma \neq 0  \nonumber
\\
\beta &\neq \gamma, \; \gamma \neq -(\alpha + \beta) \label{eq: condition_det(A)_not_zero}
\end{empheq}

%Assume that the necessary conditions in \ref{eq: condition_det(A)_not_zero} holds, we then get, that the inverse is %given by: 

\begin{comment}
\begin{align*}
A^{-1} &= 
\begingroup
\renewcommand*{\arraystretch}{3.0}
\begin{bmatrix}
\frac{
\beta -\gamma
}{
(\alpha - \beta)[\alpha\beta - \alpha\gamma + \beta^{2}-\gamma^{2}]
}
& 
\frac{
-\beta^{2}+\alpha\gamma
}{
\beta(\alpha -\beta)[\alpha\beta - \alpha\gamma + \beta^{2}-\gamma^{2}]
}
& 
-\frac{
1
}{
\alpha\beta -\alpha\gamma + \beta^{2}-\gamma^{2}
} \\
\frac{
-\beta^{2}+\gamma
}{
\alpha(\alpha-\beta)[\alpha\beta -\alpha\gamma +\beta^{2}-\gamma^{2}]
}
& 
\frac{
\alpha\beta -\gamma^{2}
}{
\beta(\alpha-\beta)[\alpha\beta -\alpha\gamma +\beta^{2}-\gamma^{2}]
}
& 
-\frac{
1
}{
\alpha\beta -\alpha\gamma +\beta^{2}-\gamma^{2}
} \\ 
\frac{
\beta-\gamma
}{
(\alpha -\beta)[\alpha\beta -\alpha\gamma + \beta^{2}-\gamma^{2}]
} 
& 
\frac{
\alpha^{2}-\beta\gamma
}{
\beta(\alpha-\beta)[\alpha\beta - \alpha\gamma + \beta^{2}-\gamma^{2}]
}
&
\frac{
\alpha + \beta
}{
\gamma[\alpha\beta -\alpha\gamma + \beta^{2} - \gamma^{2}]
}
\end{bmatrix}
\endgroup
\end{align*}
\end{comment}

Thus the optimal weight $\mathbf{x}$ will then be:   
\begin{align*}
\hat{\mathbf{x}} &= 
A^{-1}\mathbf{b}
\end{align*}


Now if the Condition \ref{eq: condition_det(A)_not_zero} does not hold, one approach could be:

\begin{align}
\label{eq: Basis_Pursuit_lp}
\begin{array}{ll@{}ll}
\text{minimize}  & \displaystyle\sum\limits_{i=1}^{3}|x_{i}|&  &\\
\text{subject to}& \displaystyle   A\mathbf{x} = & \mathbf{b}
\end{array}    
\end{align}

Assume that $\Tilde{\mathbf{x}}$ is the optimal solution to \ref{eq: Basis_Pursuit_lp}, this method is called the Basis Pursuit \cite{chen1998atomic}. 


\newpage 

\subsection{Simulation of Error distribution}

In order to say something about how good the hedge is in Result \ref{result: optimal_SOFR_hedge_3MA_vs_3GM}, we study: 
\begin{align*}
ER_{1}(t) :&= X^{3M_{A}}(S,T) - \hat{a}_{t}f^{3M}(t,S,T) \\ 
&= \frac{1}{T-S}\int_{S}^{T}r(u)du - \frac{1}{T-S}\int_{S}^{T}\E_{Q}[r(u)|\F_{t}]du \\ 
&= 
\frac{1}{T-S}\left(
\int_{S}^{T}r(u)du - \int_{S}^{T}\E_{Q}[r(u)|\F_{t}]du
\right)
\end{align*}

We will also study the Error distribution from Section \ref{sec: 3M_A_vs_(a,b,c)_1M_SOFR}, now this will correspond to: 
\begin{align*}
ER_{2}(t) &= 
X^{3M_{A}}(S,T) - \left(
\hat{a}_{t}f^{1M}(t,S,T_{1M}) + 
\hat{b}_{t}f^{1M}(t,T_{1M}, T_{2M}) + 
\hat{c}_{t}f^{1M}(t,T_{2M}, T)
\right)
\end{align*}


We choose the Vasicek model for simulation:
\begin{align*}
dr(t) &= \alpha[m-r(t)]dt + \sigma dW^{Q}(t)    
\end{align*}

In the simulation, we use the closed expression for $\int_{S}^{T}r(u)du$  as described in Equation \ref{eq: Vasicek_closed_expr_integral} p.\pageref{eq: Vasicek_closed_expr_integral}.
For simplicity we fix $t=0$, meaning that we will study: 
$ER_{1}(0)$ and $ER_{2}(0)$.

\begin{figure}[htp]
    \centering
    \includegraphics[width=12cm]{figures/SOFR/Vasicek_path.png}
    \caption{Path of Vasicek model for $u\in [0,T]$}
    \label{fig: Vasicek_path}
\end{figure}


\newpage 

\textbf{3M-arithmetic vs 3M-geometric SOFR futures:}

\begin{figure}[htp]
    \centering
    \includegraphics[width=12cm]{figures/SOFR/ER_1(0).PNG}
    \caption{Simulation of $ER_{1}(0)$}
    \label{fig: ER_1_(0)}
\end{figure}

Here we compare $X^{3M_{A}}(S,T)$ where we buy $\hat{a}_{t}$ number of $3M$-SOFR futures.
\\~\\
\textbf{3M-arithmetic vs $(\hat{a}_{t}, \hat{b}_{t}, \hat{c}_{t})$ 1M-SOFR futures}

\begin{figure}[htp]
    \centering
    \includegraphics[width=12cm]{figures/SOFR/ER_2(0)_A_inv.PNG}
    \caption{Simulation of $ER_{2}^{inv}(0)$}
    \label{fig: ER_2_(0)_A_inv}
\end{figure}

For calculating the different futures prices, we used Definition \ref{def: 1M_SOFR_futures}, p.\pageref{def: 1M_SOFR_futures}, in this simulation we got: 
\begin{align*}
\hat{x} = 
\begin{bmatrix}
0.501 \\
0.501 \\
-0.004
\end{bmatrix}
\;\text{and}\; 
\Tilde{x} = 
\begin{bmatrix}
0.499 \\ 
0.498 \\ 
0.0
\end{bmatrix}
\end{align*}